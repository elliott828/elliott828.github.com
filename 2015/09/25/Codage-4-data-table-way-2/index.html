<!doctype html>
<html class="theme-next use-motion theme-next-mist">
<head>
  

<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="google-site-verification" content="-hIKy4njeS0VoSYzKTofmv6kqKt5CyTP4IVIlIWh1N0" />
<meta name="baidu-site-verification" content="14CLULlEjC" />


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






  <link rel="stylesheet" type="text/css" href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5"/>




<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.4.5.1"/>




  <meta name="keywords" content="R,data.table," />





  <link rel="shorticon icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.1" />


<meta name="description" content="We resume the learning note.">
<meta property="og:type" content="article">
<meta property="og:title" content="data.table Way - Learning Note Part 2">
<meta property="og:url" content="http://elliott828.github.io/2015/09/25/Codage-4-data-table-way-2/index.html">
<meta property="og:site_name" content="Exity">
<meta property="og:description" content="We resume the learning note.">
<meta property="og:updated_time" content="2015-11-13T07:03:43.940Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="data.table Way - Learning Note Part 2">
<meta name="twitter:description" content="We resume the learning note.">


<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: 'Mist',
    sidebar: 'post'
  };
</script>

  <title> data.table Way - Learning Note Part 2 | Exity </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', '68396327-1', 'auto');
  ga('send', 'pageview');
</script>


  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?00cfd9a9530e4098a08a17043202505a";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>



  <div class="container one-column page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><h1 class="site-meta">
  <span class="logo-line-before"><i></i></span>
  <a href="/" class="brand" rel="start">
      <span class="logo">
        <i class="icon-next-logo"></i>
      </span>
      <span class="site-title">Exity</span>
  </a>
  <span class="logo-line-after"><i></i></span>
</h1>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu menu-left">
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            <i class="menu-item-icon icon-next-archives"></i> <br />
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            <i class="menu-item-icon icon-next-categories"></i> <br />
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            <i class="menu-item-icon icon-next-tags"></i> <br />
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            <i class="menu-item-icon icon-next-about"></i> <br />
            关于
          </a>
        </li>
      

      
      
    </ul>
  

  
    <div class="site-search">
      
  
  <form class="site-search-form">
    <input type="text" id="st-search-input" class="st-search-input st-default-search-input" />
  </form>


<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
    (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
    e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install', 'f-s39SMgF52UH9GHejVp','2.0.0');
</script>



    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content"> 

  <div id="posts" class="posts-expand">
    

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              data.table Way - Learning Note Part 2
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2015-09-25T20:41:04+08:00" content="2015-09-25">
            2015-09-25
          </time>
        </span>

        
          <span class="post-category" >
            &nbsp; | &nbsp; 分类于
            
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                <a href="/categories/Codage-编程/" itemprop="url" rel="index">
                  <span itemprop="name">Codage|编程</span>
                </a>
              </span>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2015/09/25/Codage-4-data-table-way-2/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2015/09/25/Codage-4-data-table-way-2/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        <span itemprop="articleBody"><p>We resume the <a href="http://papacochon.com/2015/09/23/Codage-3-data-table-way-1/" target="_blank" rel="external">learning note</a>.<br><a id="more"></a></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">library</span>(data.table)</div><div class="line">dtm &lt;- as.data.table(mtcars)</div></pre></td></tr></table></figure>
<h2 id="The-set-family"><a href="#The-set-family" class="headerlink" title="The set() family"></a>The set() family</h2><p>Overview of set family * <code>set()</code> is a loopable low overhead version of <code>:=</code>; * You can use <code>setnames()</code> to set or change column names; * <code>setorder()</code> and <code>setcolorder()</code> reorder the rows, columns of a <code>data.table</code>. * <code>setkey()</code> set keys in a <code>data.table</code></p>
<h3 id="set"><a href="#set" class="headerlink" title="set()"></a>set()</h3><p>To assign the column <code>am</code> to 1:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">set(dtm, j = which(colnames(dtm)==<span class="string">'am'</span>), value = <span class="number">1</span>)</div><div class="line">head(dtm)</div></pre></td></tr></table></figure>
<pre><code>##     mpg cyl disp  hp drat    wt  qsec vs am gear carb
## 1: 21.0   6  160 110 3.90 2.620 16.46  0  1    4    4
## 2: 21.0   6  160 110 3.90 2.875 17.02  0  1    4    4
## 3: 22.8   4  108  93 3.85 2.320 18.61  1  1    4    1
## 4: 21.4   6  258 110 3.08 3.215 19.44  1  1    3    1
## 5: 18.7   8  360 175 3.15 3.440 17.02  0  1    3    2
## 6: 18.1   6  225 105 2.76 3.460 20.22  1  1    3    1
</code></pre><p>Now recover it.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">set(dtm, j = which(colnames(dtm)==<span class="string">'am'</span>), value = mtcars$am)</div><div class="line">head(dtm)</div></pre></td></tr></table></figure>
<pre><code>##     mpg cyl disp  hp drat    wt  qsec vs am gear carb
## 1: 21.0   6  160 110 3.90 2.620 16.46  0  1    4    4
## 2: 21.0   6  160 110 3.90 2.875 17.02  0  1    4    4
## 3: 22.8   4  108  93 3.85 2.320 18.61  1  1    4    1
## 4: 21.4   6  258 110 3.08 3.215 19.44  1  0    3    1
## 5: 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2
## 6: 18.1   6  225 105 2.76 3.460 20.22  1  0    3    1
</code></pre><p>We create a random data.table and randomly change its value</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">temp &lt;- data.table(A = sample(<span class="number">1</span>:<span class="number">9</span>),</div><div class="line">                   B = sample(<span class="number">1</span>:<span class="number">9</span>),</div><div class="line">                   C = sample(<span class="number">1</span>:<span class="number">9</span>),</div><div class="line">                   D = sample(<span class="number">1</span>:<span class="number">9</span>),</div><div class="line">                   E = sample(<span class="number">1</span>:<span class="number">9</span>))</div><div class="line"></div><div class="line"><span class="comment"># for each row, randomly change 3 values to 10 </span></div><div class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>:<span class="number">9</span>) set(temp, i, sample(<span class="number">5</span>, <span class="number">3</span>), <span class="number">10</span>)</div><div class="line">temp</div></pre></td></tr></table></figure>
<pre><code>##     A  B  C  D  E
## 1:  5 10  6 10 10
## 2: 10  5  2 10 10
## 3: 10 10  1  4 10
## 4: 10  3  4 10 10
## 5: 10  1 10 10  9
## 6:  7  6 10 10 10
## 7:  6 10 10  6 10
## 8:  8  9 10 10 10
## 9:  9  7 10 10 10
</code></pre><h3 id="setnames"><a href="#setnames" class="headerlink" title="setnames()"></a>setnames()</h3><p>Still use the <code>data.table</code> we just created. Add ‘Col_’ to the column names.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># setnames(x, old, new)</span></div><div class="line">setnames(temp, names(temp), paste0(<span class="string">'Col_'</span>, names(temp)))</div><div class="line">head(temp, <span class="number">3</span>)</div></pre></td></tr></table></figure>
<pre><code>##    Col_A Col_B Col_C Col_D Col_E
## 1:     5    10     6    10    10
## 2:    10     5     2    10    10
## 3:    10    10     1     4    10
</code></pre><p>To remove the prefix <code>Col_</code>:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># when new is not provided, consider old as new</span></div><div class="line">setnames(temp, gsub(<span class="string">'^Col_'</span>, <span class="string">''</span>, names(temp)))</div><div class="line">head(temp, <span class="number">3</span>)</div></pre></td></tr></table></figure>
<pre><code>##     A  B C  D  E
## 1:  5 10 6 10 10
## 2: 10  5 2 10 10
## 3: 10 10 1  4 10
</code></pre><h3 id="setorder-and-setcolorder"><a href="#setorder-and-setcolorder" class="headerlink" title="setorder() and setcolorder()"></a>setorder() and setcolorder()</h3><p>To reorder the rows:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># wt in ascending order and mpg in descending order</span></div><div class="line">setorder(dtm, am, -mpg)</div><div class="line"><span class="comment"># check the first 6 rows of each group</span></div><div class="line">dtm[, head(.SD), by = am]</div></pre></td></tr></table></figure>
<pre><code>##     am  mpg cyl  disp  hp drat    wt  qsec vs gear carb
##  1:  0 24.4   4 146.7  62 3.69 3.190 20.00  1    4    2
##  2:  0 22.8   4 140.8  95 3.92 3.150 22.90  1    4    2
##  3:  0 21.5   4 120.1  97 3.70 2.465 20.01  1    3    1
##  4:  0 21.4   6 258.0 110 3.08 3.215 19.44  1    3    1
##  5:  0 19.2   6 167.6 123 3.92 3.440 18.30  1    4    4
##  6:  0 19.2   8 400.0 175 3.08 3.845 17.05  0    3    2
##  7:  1 33.9   4  71.1  65 4.22 1.835 19.90  1    4    1
##  8:  1 32.4   4  78.7  66 4.08 2.200 19.47  1    4    1
##  9:  1 30.4   4  75.7  52 4.93 1.615 18.52  1    4    2
## 10:  1 30.4   4  95.1 113 3.77 1.513 16.90  1    5    2
## 11:  1 27.3   4  79.0  66 4.08 1.935 18.90  1    4    1
## 12:  1 26.0   4 120.3  91 4.43 2.140 16.70  0    5    2
</code></pre><p>To reorder the columns by alphabetic order.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">setcolorder(dtm, sort(names(dtm)))</div><div class="line">head(dtm)</div></pre></td></tr></table></figure>
<pre><code>##    am carb cyl  disp drat gear  hp  mpg  qsec vs    wt
## 1:  0    2   4 146.7 3.69    4  62 24.4 20.00  1 3.190
## 2:  0    2   4 140.8 3.92    4  95 22.8 22.90  1 3.150
## 3:  0    1   4 120.1 3.70    3  97 21.5 20.01  1 2.465
## 4:  0    1   6 258.0 3.08    3 110 21.4 19.44  1 3.215
## 5:  0    4   6 167.6 3.92    4 123 19.2 18.30  1 3.440
## 6:  0    2   8 400.0 3.08    3 175 19.2 17.05  0 3.845
</code></pre><h3 id="setkey"><a href="#setkey" class="headerlink" title="setkey()"></a>setkey()</h3><h4 id="set-character-column-as-key"><a href="#set-character-column-as-key" class="headerlink" title="set character column as key"></a>set character column as key</h4><p>To make the <code>data.table</code> a database table. According to the document:</p>
<blockquote>
<p>setkey() sorts a data.table and marks it as sorted (with an attribute sorted). The sorted columns are the key. The key can be any columns in any order. The columns are sorted in ascending order always.</p>
<p>setkey reorders (or sorts) the rows of a data.table by the columns provided. In versions 1.9+, for integer columns… It is extremely fast, but is limited by the range of integer values being \&lt;= 1e5.</p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">dti &lt;- as.data.table(iris)</div><div class="line"></div><div class="line"><span class="comment"># Set Species as key</span></div><div class="line">setkey(dti, Species)</div><div class="line"></div><div class="line"><span class="comment"># Query by Species == 'setosa'</span></div><div class="line">head(dti[<span class="string">'setosa'</span>])</div></pre></td></tr></table></figure>
<pre><code>##    Sepal.Length Sepal.Width Petal.Length Petal.Width Species
## 1:          5.1         3.5          1.4         0.2  setosa
## 2:          4.9         3.0          1.4         0.2  setosa
## 3:          4.7         3.2          1.3         0.2  setosa
## 4:          4.6         3.1          1.5         0.2  setosa
## 5:          5.0         3.6          1.4         0.2  setosa
## 6:          5.4         3.9          1.7         0.4  setosa
</code></pre><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Select 'setosa' and 'versicolor' in the same time</span></div><div class="line">dti[c(<span class="string">'setosa'</span>, <span class="string">'versicolor'</span>)][, head(.SD, <span class="number">3</span>), by = Species]</div></pre></td></tr></table></figure>
<pre><code>##       Species Sepal.Length Sepal.Width Petal.Length Petal.Width
## 1:     setosa          5.1         3.5          1.4         0.2
## 2:     setosa          4.9         3.0          1.4         0.2
## 3:     setosa          4.7         3.2          1.3         0.2
## 4: versicolor          7.0         3.2          4.7         1.4
## 5: versicolor          6.4         3.2          4.5         1.5
## 6: versicolor          6.9         3.1          4.9         1.5
</code></pre><h4 id="set-numeric-column-as-key"><a href="#set-numeric-column-as-key" class="headerlink" title="set numeric column as key"></a>set numeric column as key</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">dtm &lt;- data.table(model = rownames(mtcars), mtcars)</div><div class="line"></div><div class="line"><span class="comment"># Set gear as key</span></div><div class="line">setkey(dtm, gear)</div><div class="line"></div><div class="line"><span class="comment"># Select records with gear == 5</span></div><div class="line">dtm[J(<span class="number">5</span>)]</div></pre></td></tr></table></figure>
<pre><code>##             model  mpg cyl  disp  hp drat    wt qsec vs am gear carb
## 1:  Porsche 914-2 26.0   4 120.3  91 4.43 2.140 16.7  0  1    5    2
## 2:   Lotus Europa 30.4   4  95.1 113 3.77 1.513 16.9  1  1    5    2
## 3: Ford Pantera L 15.8   8 351.0 264 4.22 3.170 14.5  0  1    5    4
## 4:   Ferrari Dino 19.7   6 145.0 175 3.62 2.770 15.5  0  1    5    6
## 5:  Maserati Bora 15.0   8 301.0 335 3.54 3.570 14.6  0  1    5    8
</code></pre><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># or </span></div><div class="line">dtm[.(<span class="number">5</span>)]</div></pre></td></tr></table></figure>
<pre><code>##             model  mpg cyl  disp  hp drat    wt qsec vs am gear carb
## 1:  Porsche 914-2 26.0   4 120.3  91 4.43 2.140 16.7  0  1    5    2
## 2:   Lotus Europa 30.4   4  95.1 113 3.77 1.513 16.9  1  1    5    2
## 3: Ford Pantera L 15.8   8 351.0 264 4.22 3.170 14.5  0  1    5    4
## 4:   Ferrari Dino 19.7   6 145.0 175 3.62 2.770 15.5  0  1    5    6
## 5:  Maserati Bora 15.0   8 301.0 335 3.54 3.570 14.6  0  1    5    8
</code></pre><p>Be aware that dtm[5] only returns the 5th row.</p>
<h4 id="set-multiple-columns-as-keys"><a href="#set-multiple-columns-as-keys" class="headerlink" title="set multiple columns as keys"></a>set multiple columns as keys</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># add a column: brand</span></div><div class="line">dtm[, brand:=sapply(.SD[,model], <span class="keyword">function</span>(x) strsplit(x, <span class="string">' '</span>)[[<span class="number">1</span>]][<span class="number">1</span>])]</div><div class="line"></div><div class="line">setkey(dtm, brand, cyl)</div><div class="line">dtm[.(<span class="string">'Merc'</span>, <span class="number">8</span>)]</div></pre></td></tr></table></figure>
<pre><code>##          model  mpg cyl  disp  hp drat   wt qsec vs am gear carb brand
## 1:  Merc 450SE 16.4   8 275.8 180 3.07 4.07 17.4  0  0    3    3  Merc
## 2:  Merc 450SL 17.3   8 275.8 180 3.07 3.73 17.6  0  0    3    3  Merc
## 3: Merc 450SLC 15.2   8 275.8 180 3.07 3.78 18.0  0  0    3    3  Merc
</code></pre><p>What if there is no such key?</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dtm[.(<span class="string">'Renault'</span>, <span class="number">8</span>)]</div></pre></td></tr></table></figure>
<pre><code>##    model mpg cyl disp hp drat wt qsec vs am gear carb   brand
## 1:    NA  NA   8   NA NA   NA NA   NA NA NA   NA   NA Renault
</code></pre><p>It returns NA in all columns but the 2 keys.</p>
<h4 id="select-groups"><a href="#select-groups" class="headerlink" title="select groups"></a>select groups</h4><p>By default, subsetting <code>data.table</code> returns all the records, it is related to argument <code>mult</code> of which the default value is <code>all</code>. You can also specify ‘first’ or ‘last’.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Introduce argument mult</span></div><div class="line">dti[c(<span class="string">'setosa'</span>, <span class="string">'versicolor'</span>), mult = <span class="string">'first'</span>]</div></pre></td></tr></table></figure>
<pre><code>##    Sepal.Length Sepal.Width Petal.Length Petal.Width    Species
## 1:          5.1         3.5          1.4         0.2     setosa
## 2:          7.0         3.2          4.7         1.4 versicolor
</code></pre><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dti[c(<span class="string">'setosa'</span>, <span class="string">'versicolor'</span>), mult = <span class="string">'last'</span>]</div></pre></td></tr></table></figure>
<pre><code>##    Sepal.Length Sepal.Width Petal.Length Petal.Width    Species
## 1:          5.0         3.3          1.4         0.2     setosa
## 2:          5.7         2.8          4.1         1.3 versicolor
</code></pre><p>You could also specify certain rows (<code>i</code>). To display each i, you need to specify <code>by = .EACHI</code>.</p>
<blockquote>
<p>When i is a data.table, DT[i,j,by=.EACHI] evaluates j for the groups in ‘DT’ that each row in i joins to. That is, you can join (in i) and aggregate (in j) simultaneously. We call this <strong>grouping by each i</strong>.</p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dti[c(<span class="string">'setosa'</span>, <span class="string">'versicolor'</span>), .SD[c(<span class="number">1</span>, .N)], by = .EACHI]</div></pre></td></tr></table></figure>
<pre><code>##       Species Sepal.Length Sepal.Width Petal.Length Petal.Width
## 1:     setosa          5.1         3.5          1.4         0.2
## 2:     setosa          5.0         3.3          1.4         0.2
## 3: versicolor          7.0         3.2          4.7         1.4
## 4: versicolor          5.7         2.8          4.1         1.3
</code></pre><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dti[c(<span class="string">'setosa'</span>, <span class="string">'versicolor'</span>), &#123;print(.SD[<span class="number">3</span>:<span class="number">5</span>]); .SD[c(<span class="number">1</span>, .N)]&#125;, by = .EACHI]</div></pre></td></tr></table></figure>
<pre><code>##    Sepal.Length Sepal.Width Petal.Length Petal.Width
## 1:          4.7         3.2          1.3         0.2
## 2:          4.6         3.1          1.5         0.2
## 3:          5.0         3.6          1.4         0.2
##    Sepal.Length Sepal.Width Petal.Length Petal.Width
## 1:          6.9         3.1          4.9         1.5
## 2:          5.5         2.3          4.0         1.3
## 3:          6.5         2.8          4.6         1.5

##       Species Sepal.Length Sepal.Width Petal.Length Petal.Width
## 1:     setosa          5.1         3.5          1.4         0.2
## 2:     setosa          5.0         3.3          1.4         0.2
## 3: versicolor          7.0         3.2          4.7         1.4
## 4: versicolor          5.7         2.8          4.1         1.3
</code></pre><h4 id="Rolling-joins"><a href="#Rolling-joins" class="headerlink" title="Rolling joins"></a>Rolling joins</h4><p>Let’s check the records of brand ‘Merc’ and 7 cylinders.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dtm[.(<span class="string">'Merc'</span>, <span class="number">5</span>)]</div></pre></td></tr></table></figure>
<pre><code>##    model mpg cyl disp hp drat wt qsec vs am gear carb brand
## 1:    NA  NA   5   NA NA   NA NA   NA NA NA   NA   NA  Merc
</code></pre><p>There is no such record. How to return records without <code>NA</code>? Use argument <code>roll</code>.</p>
<p><code>roll = TRUE</code>: i’s row matches to all but the last x join column, and its value in the last i join column falls in a gap (including after the last observation in x for that group), then the <em>prevailing</em> value in x is rolled <strong>forward</strong>.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dtm[.(c(<span class="string">'Merc'</span>, <span class="string">'Toyota'</span>), <span class="number">5</span>), roll = <span class="literal">TRUE</span>]</div></pre></td></tr></table></figure>
<pre><code>##             model  mpg cyl  disp hp drat    wt qsec vs am gear carb  brand
## 1:       Merc 230 22.8   5 140.8 95 3.92 3.150 22.9  1  0    4    2   Merc
## 2: Toyota Corolla 33.9   5  71.1 65 4.22 1.835 19.9  1  1    4    1 Toyota
</code></pre><p><code>roll = &#39;nearest&#39;</code>: the nearest value is joined to.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># compare the commands below</span></div><div class="line">dtm[.(c(<span class="string">'Merc'</span>, <span class="string">'Toyota'</span>), <span class="number">3</span>), roll = <span class="literal">TRUE</span>]</div></pre></td></tr></table></figure>
<pre><code>##    model mpg cyl disp hp drat wt qsec vs am gear carb  brand
## 1:    NA  NA   3   NA NA   NA NA   NA NA NA   NA   NA   Merc
## 2:    NA  NA   3   NA NA   NA NA   NA NA NA   NA   NA Toyota
</code></pre><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dtm[.(c(<span class="string">'Merc'</span>, <span class="string">'Toyota'</span>), <span class="number">3</span>), roll = <span class="string">'nearest'</span>]</div></pre></td></tr></table></figure>
<pre><code>##            model  mpg cyl  disp hp drat    wt  qsec vs am gear carb  brand
## 1:     Merc 240D 24.4   3 146.7 62 3.69 3.190 20.00  1  0    4    2   Merc
## 2: Toyota Corona 21.5   3 120.1 97 3.70 2.465 20.01  1  0    3    1 Toyota
</code></pre><p><code>roll</code> can also be a finite number.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># compare the commands below</span></div><div class="line">dtm[.(<span class="string">'Merc'</span>, <span class="number">6</span>:<span class="number">10</span>)]</div></pre></td></tr></table></figure>
<pre><code>##          model  mpg cyl  disp  hp drat   wt qsec vs am gear carb brand
## 1:    Merc 280 19.2   6 167.6 123 3.92 3.44 18.3  1  0    4    4  Merc
## 2:   Merc 280C 17.8   6 167.6 123 3.92 3.44 18.9  1  0    4    4  Merc
## 3:          NA   NA   7    NA  NA   NA   NA   NA NA NA   NA   NA  Merc
## 4:  Merc 450SE 16.4   8 275.8 180 3.07 4.07 17.4  0  0    3    3  Merc
## 5:  Merc 450SL 17.3   8 275.8 180 3.07 3.73 17.6  0  0    3    3  Merc
## 6: Merc 450SLC 15.2   8 275.8 180 3.07 3.78 18.0  0  0    3    3  Merc
## 7:          NA   NA   9    NA  NA   NA   NA   NA NA NA   NA   NA  Merc
## 8:          NA   NA  10    NA  NA   NA   NA   NA NA NA   NA   NA  Merc
</code></pre><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dtm[.(<span class="string">'Merc'</span>, <span class="number">6</span>:<span class="number">10</span>), roll = <span class="number">1</span>]</div></pre></td></tr></table></figure>
<pre><code>##          model  mpg cyl  disp  hp drat   wt qsec vs am gear carb brand
## 1:    Merc 280 19.2   6 167.6 123 3.92 3.44 18.3  1  0    4    4  Merc
## 2:   Merc 280C 17.8   6 167.6 123 3.92 3.44 18.9  1  0    4    4  Merc
## 3:   Merc 280C 17.8   7 167.6 123 3.92 3.44 18.9  1  0    4    4  Merc
## 4:  Merc 450SE 16.4   8 275.8 180 3.07 4.07 17.4  0  0    3    3  Merc
## 5:  Merc 450SL 17.3   8 275.8 180 3.07 3.73 17.6  0  0    3    3  Merc
## 6: Merc 450SLC 15.2   8 275.8 180 3.07 3.78 18.0  0  0    3    3  Merc
## 7: Merc 450SLC 15.2   9 275.8 180 3.07 3.78 18.0  0  0    3    3  Merc
## 8:          NA   NA  10    NA  NA   NA   NA   NA NA NA   NA   NA  Merc
</code></pre><p>There is no Mercedez with 7, 9 and 10 cylinders, but we allow it to roll for distance of 1. So 7 and 9 cylinders are both joined but 10 because it’s more than 1 from the prevailing observation.</p>
<p>Now we take a look on argument <code>rollends</code>. This argument is actually a vector of two logical values (a single logical is recycled).</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># compare the commands below</span></div><div class="line">setkey(dtm, am, carb)</div><div class="line">dtm[.(<span class="number">1</span>, (-<span class="number">1</span>):<span class="number">8</span>)]</div></pre></td></tr></table></figure>
<pre><code>##              model  mpg cyl  disp  hp drat    wt  qsec vs am gear carb    brand
##  1:             NA   NA  NA    NA  NA   NA    NA    NA NA  1   NA   -1       NA
##  2:             NA   NA  NA    NA  NA   NA    NA    NA NA  1   NA    0       NA
##  3:     Datsun 710 22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1   Datsun
##  4:       Fiat 128 32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1     Fiat
##  5:      Fiat X1-9 27.3   4  79.0  66 4.08 1.935 18.90  1  1    4    1     Fiat
##  6: Toyota Corolla 33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1   Toyota
##  7:    Honda Civic 30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2    Honda
##  8:   Lotus Europa 30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2    Lotus
##  9:  Porsche 914-2 26.0   4 120.3  91 4.43 2.140 16.70  0  1    5    2  Porsche
## 10:     Volvo 142E 21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    2    Volvo
## 11:             NA   NA  NA    NA  NA   NA    NA    NA NA  1   NA    3       NA
## 12: Ford Pantera L 15.8   8 351.0 264 4.22 3.170 14.50  0  1    5    4     Ford
## 13:      Mazda RX4 21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4    Mazda
## 14:  Mazda RX4 Wag 21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4    Mazda
## 15:             NA   NA  NA    NA  NA   NA    NA    NA NA  1   NA    5       NA
## 16:   Ferrari Dino 19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6  Ferrari
## 17:             NA   NA  NA    NA  NA   NA    NA    NA NA  1   NA    7       NA
## 18:  Maserati Bora 15.0   8 301.0 335 3.54 3.570 14.60  0  1    5    8 Maserati
</code></pre><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dtm[.(<span class="number">1</span>, (-<span class="number">1</span>):<span class="number">8</span>), roll = <span class="literal">TRUE</span>]</div></pre></td></tr></table></figure>
<pre><code>##              model  mpg cyl  disp  hp drat    wt  qsec vs am gear carb    brand
##  1:             NA   NA  NA    NA  NA   NA    NA    NA NA  1   NA   -1       NA
##  2:             NA   NA  NA    NA  NA   NA    NA    NA NA  1   NA    0       NA
##  3:     Datsun 710 22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1   Datsun
##  4:       Fiat 128 32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1     Fiat
##  5:      Fiat X1-9 27.3   4  79.0  66 4.08 1.935 18.90  1  1    4    1     Fiat
##  6: Toyota Corolla 33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1   Toyota
##  7:    Honda Civic 30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2    Honda
##  8:   Lotus Europa 30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2    Lotus
##  9:  Porsche 914-2 26.0   4 120.3  91 4.43 2.140 16.70  0  1    5    2  Porsche
## 10:     Volvo 142E 21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    2    Volvo
## 11:     Volvo 142E 21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    3    Volvo
## 12: Ford Pantera L 15.8   8 351.0 264 4.22 3.170 14.50  0  1    5    4     Ford
## 13:      Mazda RX4 21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4    Mazda
## 14:  Mazda RX4 Wag 21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4    Mazda
## 15:  Mazda RX4 Wag 21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    5    Mazda
## 16:   Ferrari Dino 19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6  Ferrari
## 17:   Ferrari Dino 19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    7  Ferrari
## 18:  Maserati Bora 15.0   8 301.0 335 3.54 3.570 14.60  0  1    5    8 Maserati
</code></pre><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dtm[.(<span class="number">1</span>, (-<span class="number">1</span>):<span class="number">8</span>), roll = <span class="literal">TRUE</span>, rollends = <span class="literal">TRUE</span>]</div></pre></td></tr></table></figure>
<pre><code>##              model  mpg cyl  disp  hp drat    wt  qsec vs am gear carb    brand
##  1:     Datsun 710 22.8   4 108.0  93 3.85 2.320 18.61  1  1    4   -1   Datsun
##  2:     Datsun 710 22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    0   Datsun
##  3:     Datsun 710 22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1   Datsun
##  4:       Fiat 128 32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1     Fiat
##  5:      Fiat X1-9 27.3   4  79.0  66 4.08 1.935 18.90  1  1    4    1     Fiat
##  6: Toyota Corolla 33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1   Toyota
##  7:    Honda Civic 30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2    Honda
##  8:   Lotus Europa 30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2    Lotus
##  9:  Porsche 914-2 26.0   4 120.3  91 4.43 2.140 16.70  0  1    5    2  Porsche
## 10:     Volvo 142E 21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    2    Volvo
## 11:     Volvo 142E 21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    3    Volvo
## 12: Ford Pantera L 15.8   8 351.0 264 4.22 3.170 14.50  0  1    5    4     Ford
## 13:      Mazda RX4 21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4    Mazda
## 14:  Mazda RX4 Wag 21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4    Mazda
## 15:  Mazda RX4 Wag 21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    5    Mazda
## 16:   Ferrari Dino 19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6  Ferrari
## 17:   Ferrari Dino 19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    7  Ferrari
## 18:  Maserati Bora 15.0   8 301.0 335 3.54 3.570 14.60  0  1    5    8 Maserati
</code></pre><p>This argument allows <code>NA</code> records to look forward to the nearest‘matching’ records</p>
<h2 id="Other-data-table-functions"><a href="#Other-data-table-functions" class="headerlink" title="Other data.table functions"></a>Other data.table functions</h2><h3 id="fread-fast-read"><a href="#fread-fast-read" class="headerlink" title="fread() fast read"></a>fread() fast read</h3><p>Borrow the example from <code>data.table</code> document:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">n=<span class="number">1e6</span></div><div class="line">DT = data.table( a=sample(<span class="number">1</span>:<span class="number">1000</span>,n,replace=<span class="literal">TRUE</span>),</div><div class="line">                 b=sample(<span class="number">1</span>:<span class="number">1000</span>,n,replace=<span class="literal">TRUE</span>),</div><div class="line">                 c=rnorm(n),</div><div class="line">                 d=sample(c(<span class="string">"foo"</span>,<span class="string">"bar"</span>,<span class="string">"baz"</span>,<span class="string">"qux"</span>,<span class="string">"quux"</span>),n,replace=<span class="literal">TRUE</span>),</div><div class="line">                 e=rnorm(n),</div><div class="line">                 f=sample(<span class="number">1</span>:<span class="number">1000</span>,n,replace=<span class="literal">TRUE</span>) )</div><div class="line">DT[<span class="number">2</span>,b:=<span class="literal">NA_integer_</span>]</div><div class="line">DT[<span class="number">4</span>,c:=<span class="literal">NA_real_</span>]</div><div class="line">DT[<span class="number">3</span>,d:=<span class="literal">NA_character_</span>]</div><div class="line">DT[<span class="number">5</span>,d:=<span class="string">""</span>]</div><div class="line">DT[<span class="number">2</span>,e:=+<span class="literal">Inf</span>]</div><div class="line">DT[<span class="number">3</span>,e:=-<span class="literal">Inf</span>]</div><div class="line"></div><div class="line">write.table(DT,<span class="string">"test.csv"</span>,sep=<span class="string">","</span>,row.names=<span class="literal">FALSE</span>,quote=<span class="literal">FALSE</span>)</div><div class="line">cat(<span class="string">"File size (MB):"</span>, round(file.info(<span class="string">"test.csv"</span>)$size/<span class="number">1024</span>^<span class="number">2</span>),<span class="string">"\n"</span>)</div></pre></td></tr></table></figure>
<pre><code>## File size (MB): 50
</code></pre><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">system.time(DF1 &lt;-read.csv(<span class="string">"test.csv"</span>,stringsAsFactors=<span class="literal">FALSE</span>))</div></pre></td></tr></table></figure>
<pre><code>##    user  system elapsed 
##  21.556   0.196  21.760
</code></pre><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># first time in fresh R session</span></div><div class="line"></div><div class="line">system.time(DF1 &lt;- read.csv(<span class="string">"test.csv"</span>,stringsAsFactors=<span class="literal">FALSE</span>))</div></pre></td></tr></table></figure>
<pre><code>##    user  system elapsed 
##  11.728   0.144  11.873
</code></pre><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># immediate repeat is faster, varies</span></div><div class="line"></div><div class="line">system.time(DF2 &lt;- read.table(<span class="string">"test.csv"</span>,header=<span class="literal">TRUE</span>,sep=<span class="string">","</span>,quote=<span class="string">""</span>,</div><div class="line">					stringsAsFactors=<span class="literal">FALSE</span>,comment.char=<span class="string">""</span>,nrows=n,</div><div class="line">					colClasses=c(<span class="string">"integer"</span>,<span class="string">"integer"</span>,<span class="string">"numeric"</span>,</div><div class="line">					             <span class="string">"character"</span>,<span class="string">"numeric"</span>,<span class="string">"integer"</span>)))</div></pre></td></tr></table></figure>
<pre><code>##    user  system elapsed 
##   7.324   0.040   7.369
</code></pre><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">require</span>(data.table)</div><div class="line">system.time(DT &lt;- fread(<span class="string">"test.csv"</span>))</div></pre></td></tr></table></figure>
<pre><code>##    user  system elapsed 
##   1.988   0.008   1.993
</code></pre><p>This is a powerful file reading function.</p>
<h3 id="others"><a href="#others" class="headerlink" title="others"></a>others</h3><p>Enter the command <code>library(help = data.table)</code> and you could see many other small functions, like <code>frank</code>, <code>foverlaps</code>, etc. All of them are aiming at speeding up the available functions with similar effect in <code>base</code> or other packages. You could take a look on them when necessary.</p>
<hr>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="https://www.datacamp.com/courses/data-table-data-manipulation-r-tutorial" target="_blank" rel="external">Data Analysis in R, the data.table Way</a>.</li>
</ul>
</span>
      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/R/" rel="tag">#R</a>
          
            <a href="/tags/data-table/" rel="tag">#data.table</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-prev post-nav-item">
            
              <a href="/2015/09/30/LaVie-4-never-know/" rel="prev">未然</a>
            
          </div>

          <div class="post-nav-next post-nav-item">
            
              <a href="/2015/09/24/Codage-5-install-jdk8-on-ubuntu/" rel="next">Install jdk8 on Ubuntu 14.04</a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>

 </div>

        

        
          <div class="comments" id="comments">
            
              <div class="ds-thread" data-thread-key="2015/09/25/Codage-4-data-table-way-2/"
                   data-title="data.table Way - Learning Note Part 2" data-url="http://elliott828.github.io/2015/09/25/Codage-4-data-table-way-2/">
              </div>
            
          </div>
        
      </div>

      
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="/uploads/avatar_storm_cat_white.png" alt="Papa Cochon" itemprop="image"/>
          <p class="site-author-name" itemprop="name">Papa Cochon</p>
        </div>
        <p class="site-description motion-element" itemprop="description"></p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">70</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            <a href="/categories">
              <span class="site-state-item-count">11</span>
              <span class="site-state-item-name">分类</span>
              </a>
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">93</span>
              <span class="site-state-item-name">标签</span>
              </a>
          </div>

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
            <p class="site-author-name"></p>
            
              <span class="links-of-author-item">
              <a href="http://monkey0105.github.io/" target="_blank">大师兄</a>
              </span>
            
          
        </div>

      </section>

      
        <section class="post-toc-wrap sidebar-panel-active">
          <div class="post-toc-indicator-top post-toc-indicator"></div>
          <div class="post-toc">
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#The-set-family"><span class="nav-number">1.</span> <span class="nav-text">The set() family</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#set"><span class="nav-number">1.1.</span> <span class="nav-text">set()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#setnames"><span class="nav-number">1.2.</span> <span class="nav-text">setnames()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#setorder-and-setcolorder"><span class="nav-number">1.3.</span> <span class="nav-text">setorder() and setcolorder()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#setkey"><span class="nav-number">1.4.</span> <span class="nav-text">setkey()</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#set-character-column-as-key"><span class="nav-number">1.4.1.</span> <span class="nav-text">set character column as key</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#set-numeric-column-as-key"><span class="nav-number">1.4.2.</span> <span class="nav-text">set numeric column as key</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#set-multiple-columns-as-keys"><span class="nav-number">1.4.3.</span> <span class="nav-text">set multiple columns as keys</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#select-groups"><span class="nav-number">1.4.4.</span> <span class="nav-text">select groups</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Rolling-joins"><span class="nav-number">1.4.5.</span> <span class="nav-text">Rolling joins</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Other-data-table-functions"><span class="nav-number">2.</span> <span class="nav-text">Other data.table functions</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#fread-fast-read"><span class="nav-number">2.1.</span> <span class="nav-text">fread() fast read</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#others"><span class="nav-number">2.2.</span> <span class="nav-text">others</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Reference"><span class="nav-number">3.</span> <span class="nav-text">Reference</span></a></li></ol></div>
            
          </div>
          <div class="post-toc-indicator-bottom post-toc-indicator"></div>
        </section>
      

    </div>
  </aside>


    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner"> <div class="copyright" >
  
  &copy; &nbsp;  2015 - 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="icon-next-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Papa Cochon</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

<div class="visit-statistics">
	<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
	</script>

	<span id="busuanzi_container_site_pv">
		<span id="busuanzi_value_site_pv"></span> hits from
	</span>
	
	<span id="busuanzi_container_site_uv">
		<span id="busuanzi_value_site_uv"></span> visitors 
	</span>
</div>


 </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  
  
    

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"papacochon"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>
    
     
  	<script src="/js/ua-parser.min.js"></script>
  	<script src="/js/hook-duoshuo.js"></script>
  

    
  
  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.1"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.1"></script>
  

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/js/motion_global.js?v=0.4.5.1" id="motion.global"></script>




  <script type="text/javascript" src="/js/nav-toggle.js?v=0.4.5.1"></script>
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  
<script type="text/javascript" src="/js/bootstrap.scrollspy.js?v=0.4.5.1" id="bootstrap.scrollspy.custom"></script>


<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.motion.complete', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      var $indicator = $(indicator);
      var opacity = action === 'show' ? 0.4 : 0;
      $indicator.velocity ?
        $indicator.velocity('stop').velocity({
          opacity: opacity
        }, { duration: 100 }) :
        $indicator.stop().animate({
          opacity: opacity
        }, 100);
    }

  });
</script>

<script type="text/javascript" id="sidebar.nav">
  $(document).ready(function () {
    var html = $('html');
    var TAB_ANIMATE_DURATION = 200;
    var hasVelocity = $.isFunction(html.velocity);

    $('.sidebar-nav li').on('click', function () {
      var item = $(this);
      var activeTabClassName = 'sidebar-nav-active';
      var activePanelClassName = 'sidebar-panel-active';
      if (item.hasClass(activeTabClassName)) {
        return;
      }

      var currentTarget = $('.' + activePanelClassName);
      var target = $('.' + item.data('target'));

      hasVelocity ?
        currentTarget.velocity('transition.slideUpOut', TAB_ANIMATE_DURATION, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', TAB_ANIMATE_DURATION)
            .addClass(activePanelClassName);
        }) :
        currentTarget.animate({ opacity: 0 }, TAB_ANIMATE_DURATION, function () {
          currentTarget.hide();
          target
            .stop()
            .css({'opacity': 0, 'display': 'block'})
            .animate({ opacity: 1 }, TAB_ANIMATE_DURATION, function () {
              currentTarget.removeClass(activePanelClassName);
              target.addClass(activePanelClassName);
            });
        });

      item.siblings().removeClass(activeTabClassName);
      item.addClass(activeTabClassName);
    });

    $('.post-toc a').on('click', function (e) {
      e.preventDefault();
      var targetSelector = escapeSelector(this.getAttribute('href'));
      var offset = $(targetSelector).offset().top;
      hasVelocity ?
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        }) :
        $('html, body').stop().animate({
          scrollTop: offset
        }, 500);
    });

    // Expand sidebar on post detail page by default, when post has a toc.
    var $tocContent = $('.post-toc-content');
    if (isDesktop() && CONFIG.sidebar === 'post') {
      if ($tocContent.length > 0 && $tocContent.html().trim().length > 0) {
        displaySidebar();
      }
    }
  });
</script>



  <script type="text/javascript">
    $(document).ready(function () {
      if (CONFIG.sidebar === 'always') {
        displaySidebar();
      }
      if (isMobile()) {
        FastClick.attach(document.body);
      }
    });
  </script>

  
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
  });
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for (i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


  
  

  
  <script type="text/javascript" src="/js/lazyload.js"></script>
  <script type="text/javascript">
    $(function () {
      $("#posts").find('img').lazyload({
        placeholder: "/images/loading.gif",
        effect: "fadeIn"
      });
    });
  </script>
</body>
</html>
